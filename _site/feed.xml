<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2025-07-17T17:52:59+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">The Darwin Code</title><subtitle>Artificial Intelligence Applied to sicentific Research</subtitle><author><name>Iván Cortés</name></author><entry><title type="html">Approaching cliff species distribution using RandomForest</title><link href="http://localhost:4000/Cliff-species-models.html" rel="alternate" type="text/html" title="Approaching cliff species distribution using RandomForest" /><published>2025-06-16T00:00:00+02:00</published><updated>2025-06-16T00:00:00+02:00</updated><id>http://localhost:4000/Cliff-species-models</id><content type="html" xml:base="http://localhost:4000/Cliff-species-models.html"><![CDATA[<p>Species Distribution modelling (SDM) is a powerful tool that can be used to understand the distribution of certain species in a given area and be used to inform conservation efforts, especially for species that are threatened or endangered. In this post, we will discuss how we used Random Forests (RF) to model the distribution of cliff species in Mallorca, Balearic Islands, Spain. specific information about methods and results can be found in the <a href="https://doi.org/10.1016/j.baae.2024.08.001">original manuscript</a> in the Journal <a href="https://www.sciencedirect.com/journal/basic-and-applied-ecology">Basic and Applied Ecology</a>.</p>

<p>SDMs are supervised learning algortihms that require ocurrence data as response variable and environmental variables as predictors. In this case, the response variable was the presence of cliff species, and the predictors were environmental variables such as altitude, slope, aspect and biolcimatic data. We used <a href="https://www.worldclim.org/">WorldClim</a> data to obtain the environmental variables.</p>

<p>Data for the study was obtained from the <a href="https://www.gbif.org/">Global Biodiversity Information Facility (GBIF)</a>, which provides access to a wide range of biodiversity data. The data was filtered to include only cliff species in Mallorca, and the coordinates were used to create a spatial dataset. This dataset was enlarged with own data collected in the field. Maps were created using <a href="https://www.qgis.org/en/site/">QGIS</a>. At the end, 20 species were selected for the analysis, representing over ~3000 occurences.</p>

<p><img src="./assets/img/posts/Species_distribution_cliffs/GBIF_records.jpg" alt="GBIF records of selected cliff species" /></p>

<p>A challenge and one of the most sensible parts of Species distribution modelling is the creation of absence data, which is necessary to train the model. In this case, we generated buffers of 
1km areound the presence points and used these buffers to create pseudo-absence points. This method is widely used in SDMs, but it is important to note that it can introduce bias in the model if not done correctly. We used a random sampling approach to select the pseudo-absence points, ensuring that they were not too close to the presence points.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">terra</span><span class="p">)</span><span class="w">
</span><span class="c1"># Occurrences and Raster loading ####</span><span class="w">
</span><span class="n">Species_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vect</span><span class="p">(</span><span class="s2">"~/Cliff_Occurrences_ESTR25831.shp"</span><span class="p">)</span><span class="w">
</span><span class="n">Predictive_rasters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rast</span><span class="p">(</span><span class="s2">"~/Predictive_Europe.tif"</span><span class="p">)</span><span class="w">
</span><span class="n">Europe_Limits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vect</span><span class="p">(</span><span class="s2">"~/Coastline_Europe_25381.shp"</span><span class="p">)</span><span class="w">
</span><span class="n">Balearic_Limits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vect</span><span class="p">(</span><span class="s2">"~/Coastline_BalearicIslands_25831.shp"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Pseudo-Absence calculation ####</span><span class="w">
</span><span class="n">absence_multiplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">buffers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">buffer</span><span class="p">(</span><span class="n">Species_data</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">

</span><span class="n">Background_area</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">erase</span><span class="p">(</span><span class="n">Limites_Europe</span><span class="p">,</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">buffers</span><span class="p">))</span><span class="w">

</span><span class="n">Absence_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">spatSample</span><span class="p">(</span><span class="n">Background_area</span><span class="p">,</span><span class="w"> 
                                    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">absence_multiplier</span><span class="o">*</span><span class="n">nrow</span><span class="p">(</span><span class="n">Species_data</span><span class="p">),</span><span class="w">
                                    </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"random"</span><span class="p">)</span><span class="w">


</span></code></pre></div></div>
<p>Using this code, we cropped the buffers from the background area (Europe limits) and sampled random points from it.</p>

<p>Then, we extracted the environmental variables from the presence and pseudo-absence points using the <code class="language-plaintext highlighter-rouge">extract</code> function from the <code class="language-plaintext highlighter-rouge">terra</code> package. This allowed us to create a dataset with the presence and absence points, along with the environmental variables.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">extracted_predictors_raw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">terra</span><span class="o">::</span><span class="n">extract</span><span class="p">(</span><span class="n">Predictive_rasters</span><span class="p">,</span><span class="w"> </span><span class="n">occs</span><span class="p">,</span><span class="w"> </span><span class="n">xy</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">bind</span><span class="o">=</span><span class="nb">T</span><span class="p">))</span><span class="w">

</span><span class="n">extracted_predictors_raw2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extracted_predictors_raw</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="s2">"Presence"</span><span class="p">,</span><span class="o">-</span><span class="s2">"x"</span><span class="p">,</span><span class="o">-</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="s2">"Geo"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="s2">"Land_Use"</span><span class="p">)</span><span class="w">
</span><span class="n">extracted_predictors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extracted_predictors_raw</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="s2">"Presence"</span><span class="p">,</span><span class="s2">"x"</span><span class="p">,</span><span class="s2">"y"</span><span class="p">,</span><span class="s2">"Geo"</span><span class="p">,</span><span class="s2">"Land_Use"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Fill missing data</span><span class="w">
</span><span class="n">extracted_NA_kNN</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">caret</span><span class="o">::</span><span class="n">preProcess</span><span class="p">(</span><span class="n">extracted_predictors_raw2</span><span class="p">,</span><span class="w">
                                      </span><span class="n">method</span><span class="o">=</span><span class="s2">"bagImpute"</span><span class="p">)</span><span class="w">
</span><span class="n">missing_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">extracted_NA_kNN</span><span class="p">,</span><span class="w"> </span><span class="n">extracted_predictors_raw2</span><span class="p">)</span><span class="w">

</span><span class="n">cliff_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">extracted_predictors</span><span class="p">,</span><span class="w"> </span><span class="n">missing_points</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Note the use of <code class="language-plaintext highlighter-rouge">caret::preProcess</code> to fill missing data using bagInputing (based on Regression Trees), but other options are available (mean, median, knn or linear imputation ). This is a common approach to handle missing data in SDMs, as it allows us to use all available data without losing information, as some supervised learning algorithms do not handle missing data well.</p>

<p>Although some altogrithm can handle well with correlated variables, it is a good practice to check for multicollinearity in the predictors. In this case, we used the <code class="language-plaintext highlighter-rouge">vif</code> function from the <code class="language-plaintext highlighter-rouge">usdm</code> package to calculate the Variance Inflation Factor (VIF) and remove highly correlated variables.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">loop_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">loop_val</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">Numeric_spg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cliff_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="s2">"Presence"</span><span class="p">,</span><span class="o">-</span><span class="s2">"x"</span><span class="p">,</span><span class="o">-</span><span class="s2">"y"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select_if</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="n">is.numeric</span><span class="p">)</span><span class="w">
  
  </span><span class="n">VIF_numeric</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">usdm</span><span class="o">::</span><span class="n">vif</span><span class="p">(</span><span class="n">Numeric_spg</span><span class="p">[,</span><span class="m">6</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">Numeric_spg</span><span class="p">)])</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">arrange</span><span class="p">(</span><span class="n">VIF</span><span class="p">)</span><span class="w">
  </span><span class="n">VIF_numeric</span><span class="w"> 
  
  </span><span class="n">Selected_variables</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">VIF_numeric</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">VIF_numeric</span><span class="o">$</span><span class="n">VIF</span><span class="p">)),]</span><span class="w">
  
  </span><span class="n">cliff_selected_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cliff_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
                  </span><span class="n">select</span><span class="p">(</span><span class="s2">"Presence"</span><span class="p">,</span><span class="s2">"x"</span><span class="p">,</span><span class="s2">"y"</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">Numeric_spg</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">]),</span><span class="w">
                         </span><span class="n">Selected_variables</span><span class="o">$</span><span class="n">Variables</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">Not_Numeric_spg</span><span class="p">))</span><span class="w">
  
  </span><span class="n">loop_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">VIF_numeric</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">VIF_numeric</span><span class="o">$</span><span class="n">VIF</span><span class="p">)),</span><span class="m">2</span><span class="p">]</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"max VIF at"</span><span class="p">,</span><span class="w"> </span><span class="n">loop_val</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Finally, we used the <code class="language-plaintext highlighter-rouge">ranger</code> package to train a Random Forest model on the data. The model was trained using 40-fold cross-validation and repeated 40 times to ensure robustness. The model was then used to predict the distribution of cliff species in Mallorca. We opted to use RandomForest as it is a flexible algorithm that can handle non-linear relationships, less restrictive assumptions about the data than Generalised Linear Models, and is robust to overfitting.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Random Forest model ####</span><span class="w">
</span><span class="n">cliff_selected_data</span><span class="o">$</span><span class="n">Presence</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">cliff_selected_data</span><span class="o">$</span><span class="n">Presence</span><span class="p">)</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">cliff_selected_data</span><span class="o">$</span><span class="n">Presence</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Ausence"</span><span class="p">,</span><span class="s2">"Presence"</span><span class="p">)</span><span class="w">

</span><span class="n">rf.task</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">makeClassifTask</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cliff_selected_data</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Presence"</span><span class="p">)</span><span class="w">
</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tuneRanger</span><span class="p">(</span><span class="n">rf.task</span><span class="p">,</span><span class="w"> </span><span class="n">measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">multiclass.brier</span><span class="p">),</span><span class="w"> </span><span class="n">num.trees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w">
                  </span><span class="n">num.threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">iters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">save.file.path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w">

</span><span class="n">cliff_RF_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">caret</span><span class="o">::</span><span class="n">train</span><span class="p">(</span><span class="w">
  </span><span class="n">cliff_selected_data</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="w">     </span><span class="c1"># This way the factor rasters are keep together</span><span class="w">
  </span><span class="n">as.factor</span><span class="p">(</span><span class="n">cliff_selected_data</span><span class="o">$</span><span class="n">Presence</span><span class="p">),</span><span class="w">
  </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ranger"</span><span class="p">,</span><span class="w">
  </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainControl</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"repeatedcv"</span><span class="p">,</span><span class="w">   </span><span class="c1"># k-fold cross-validation</span><span class="w">
                           </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w">             </span><span class="c1"># 40 folds</span><span class="w">
                           </span><span class="n">repeats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w">            </span><span class="c1"># repeated 40 times</span><span class="w">
                           </span><span class="n">allowParallel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w">
                           </span><span class="n">classProbs</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w">
                           </span><span class="n">returnData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w">
                           </span><span class="n">savePredictions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"final"</span><span class="p">),</span><span class="w">
  </span><span class="n">tuneGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expand.grid</span><span class="p">(</span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">recommended.pars</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w">
                         </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">recommended.pars</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w">
                         </span><span class="n">splitrule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gini"</span><span class="p">),</span><span class="w">
  </span><span class="n">num.trees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w">
  </span><span class="n">num.threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w">
  </span><span class="n">importance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'impurity'</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>After training the model, we evaluated its performance using the <code class="language-plaintext highlighter-rouge">confusionMatrix</code> function from the <code class="language-plaintext highlighter-rouge">caret</code> package. This allowed us to assess the accuracy of the model and its ability to correctly classify presence and absence points.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conf_RF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">confusionMatrix</span><span class="p">(</span><span class="n">cliff_RF_model</span><span class="p">)</span><span class="o">$</span><span class="n">table</span><span class="w">
</span></code></pre></div></div>

<p>The confusion matrix showed that the model had a high accuracy, with a sensitivity of X and a specificity of X…</p>

<p>One of the most beatifoul things about randomForest is that it provides a measure of variable importance, which can be used to understand which environmental variables are most important for the distribution of cliff species. We used <code class="language-plaintext highlighter-rouge">importance</code> function from the <code class="language-plaintext highlighter-rouge">ranger</code> package to obtain the variable importance scores and plotted them using <code class="language-plaintext highlighter-rouge">ggplot2</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">importance_scores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">importance</span><span class="p">(</span><span class="n">cliff_RF_model</span><span class="o">$</span><span class="n">finalModel</span><span class="p">))</span><span class="w">
</span><span class="n">importance_scores</span><span class="o">$</span><span class="n">Variable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">importance_scores</span><span class="p">)</span><span class="w">
</span><span class="n">importance_scores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">importance_scores</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">IncNodePurity</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>With a little bit of ggplot magic, we can visualize the importance of each variable in the model</p>

<p><img src="./assets/img/posts/Species_distribution_cliffs/SHAP.jpg" alt="Variable importance plot" /></p>

<p>Also, we are able to see how the model undestands the relationship between the environmental variables and the presence of cliff species. We can use the <code class="language-plaintext highlighter-rouge">partialPlot</code> function from the <code class="language-plaintext highlighter-rouge">ranger</code> package to visualize the partial dependence of each variable on the model predictions.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vars</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"BIO9"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BIO19"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Slope"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BIO4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Elevation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BIO3"</span><span class="p">)</span><span class="w">

</span><span class="n">plots</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">vars</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">pd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">partial</span><span class="p">(</span><span class="n">cliff_RF_model</span><span class="p">,</span><span class="w"> </span><span class="n">pred.var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var</span><span class="p">,</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_data</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="n">autoplot</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">ggtitle</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">
</span><span class="p">})</span><span class="w">

</span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">grobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plots</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="./assets/img/posts/Species_distribution_cliffs/PDP.jpg" alt="Partial dependence plot" /></p>

<p>We can observe that the model predicts relationships between probability of presence and onvironmental variables, such as BIO9 (Mean Temperature of Driest Quarter), BIO19 (Precipitation of Coldest Quarter), Slope, BIO4 (Temperature Seasonality), Elevation and BIO3 (Isothermality) quite different than lineal or logistic, which is one of the advantages of using tree-based models.</p>

<p>Finally, we can use the trained model to predict the distribution of cliff species in Mallorca. We used the <code class="language-plaintext highlighter-rouge">predict</code> function from the <code class="language-plaintext highlighter-rouge">terra</code> package to make predictions on the environmental variables raster data, generating directly a raster file which can be easily visualized in QGIS or any other GIS software.</p>

<p><img src="./assets/img/posts/Species_distribution_cliffs/current_map.jpg" alt="Predicted distribution of cliff species in Mallorca" /></p>

<p>We can observe how the model predicts the distribution of cliff species. Mallorca, because of its high mountainous areas in comparison to the other islands, has a high probability of presence of cliff species in the north and northwest areas, where the highest cliffs are located. The model also predicts lower probabilities of presence in the southern and eastern areas, where the cliffs are less pronounced.</p>

<p>Finally, we can change environmental raster variables to predict how the distribution of cliff species would change under different scenarios of climate change.</p>

<p><img src="./assets/img/posts/Species_distribution_cliffs/future_map.jpg" alt="Predicted distribution of cliff species in Mallorca under climate change scenarios" /></p>

<p>In comparison with the current distribution, we can see that distribution area is considerably reduced in future scenarios of climate change, even in the most moderate (SSP1-2.6), as a result of modifications temperatures and precipitation patterns. This highlights the importance of using SDMs to predict the impact of climate change on species distribution and inform conservation efforts.</p>

<tweet>Using Random Forests to model the distribution of cliff species in Mallorca, we predict a significant reduction in their distribution area under climate change scenarios, enhancing their conservation priority</tweet>

<p><em>Note: we have ommited train-test split and hyperparameter tuning for simplicity, but it is a good practice to avoid overfitting and achieve better generalization capabilities</em></p>]]></content><author><name>Iván Cortés Fernández</name></author><category term="manuscript" /><category term="R" /><category term="species distribution modelling" /><category term="machine learning" /><category term="artificial intelligence" /><category term="consrvation" /><summary type="html"><![CDATA[Predicting]]></summary></entry><entry><title type="html">Detecting cardiac disfunctions using Transfer Learning</title><link href="http://localhost:4000/Transfer-Learning-Ecochardia.html" rel="alternate" type="text/html" title="Detecting cardiac disfunctions using Transfer Learning" /><published>2025-06-16T00:00:00+02:00</published><updated>2025-06-16T00:00:00+02:00</updated><id>http://localhost:4000/Transfer-Learning-Ecochardia</id><content type="html" xml:base="http://localhost:4000/Transfer-Learning-Ecochardia.html"><![CDATA[<p>Under development
<!-- <iframe width="560" height="315" src="https://www.youtube.com/embed/tjzOzuKQhSM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> --></p>

<!-- <tweet>In a computer generated artistic work, both the person who undertook all the arrangements necessary for its creation as well as the original authors of the data input need to be credited.</tweet>  -->

<!-- 
![The next Rembrandt](./assets/img/posts/20210420/post8-rembrandt2.jpg)
<small>[The Next Rembrandt](https://www.jwt.com/en/work/thenextrembrandt) is a computer-generated 3-D–printed painting developed by a facial-recognition algorithm that scanned data from 346 known paintings by the Dutch painter in a process lasting 18 months. The portrait is based on 168,263 fragments from Rembrandt’s works.</small> -->]]></content><author><name>Iván Cortés Fernández</name></author><category term="project" /><category term="neural networks" /><category term="transfer learning" /><category term="ImageNet" /><summary type="html"><![CDATA[Under development]]></summary></entry><entry><title type="html">Begining of life. Using GLMs to understand plant germination</title><link href="http://localhost:4000/Using_GLM_germination.html" rel="alternate" type="text/html" title="Begining of life. Using GLMs to understand plant germination" /><published>2021-04-02T00:00:00+02:00</published><updated>2021-04-02T00:00:00+02:00</updated><id>http://localhost:4000/Using_GLM_germination</id><content type="html" xml:base="http://localhost:4000/Using_GLM_germination.html"><![CDATA[<p>Under development</p>]]></content><author><name>Iván Cortés Fernández</name></author><category term="theory" /><summary type="html"><![CDATA[Under development]]></summary></entry><entry><title type="html">Aplying System Dynamics Models To Mar Menor Lagoon</title><link href="http://localhost:4000/SDM_Mar_Menor.html" rel="alternate" type="text/html" title="Aplying System Dynamics Models To Mar Menor Lagoon" /><published>2021-03-24T00:00:00+01:00</published><updated>2021-03-24T00:00:00+01:00</updated><id>http://localhost:4000/SDM_Mar_Menor</id><content type="html" xml:base="http://localhost:4000/SDM_Mar_Menor.html"><![CDATA[<p>Under development</p>]]></content><author><name>Iván Cortés Fernánez</name></author><category term="general blogging" /><category term="thoughts" /><category term="life" /><summary type="html"><![CDATA[Under development]]></summary></entry><entry><title type="html">Using Capture-Recapture models to estimate population dynamics</title><link href="http://localhost:4000/Alytes-population-dynamics.html" rel="alternate" type="text/html" title="Using Capture-Recapture models to estimate population dynamics" /><published>2021-03-18T22:14:20+01:00</published><updated>2021-03-18T22:14:20+01:00</updated><id>http://localhost:4000/Alytes-population-dynamics</id><content type="html" xml:base="http://localhost:4000/Alytes-population-dynamics.html"><![CDATA[<h2 id="background">Background</h2>]]></content><author><name>Iván Cortés</name></author><summary type="html"><![CDATA[Inspired by Deep Mind's astonishing feats of having their Alpha Go, Alpha Zero and Alpha Star programs learn (and be amazing at it) Go, Chess, Atari games and lately Starcraft; I set myself to the task of programming a neural network that will learn by itself how to play the ancient game of tic tac toe. How hard could it be?]]></summary></entry><entry><title type="html">Understanding bryophyte distribution using environmental data</title><link href="http://localhost:4000/Bryophyte_distribution-copy.html" rel="alternate" type="text/html" title="Understanding bryophyte distribution using environmental data" /><published>2021-03-12T20:32:20+01:00</published><updated>2021-03-12T20:32:20+01:00</updated><id>http://localhost:4000/Bryophyte_distribution%20copy</id><content type="html" xml:base="http://localhost:4000/Bryophyte_distribution-copy.html"><![CDATA[<p>Under development</p>

<h3 id="adam">Adam</h3>]]></content><author><name>Iván Cortés, Pere Miquel</name></author><summary type="html"><![CDATA[Under development]]></summary></entry><entry><title type="html">Analysing pollination networks in R</title><link href="http://localhost:4000/pollination-networks.html" rel="alternate" type="text/html" title="Analysing pollination networks in R" /><published>2021-03-12T20:32:20+01:00</published><updated>2021-03-12T20:32:20+01:00</updated><id>http://localhost:4000/pollination-networks</id><content type="html" xml:base="http://localhost:4000/pollination-networks.html"><![CDATA[<p>Under development</p>

<h3 id="adam">Adam</h3>]]></content><author><name>Iván Cortés</name></author><summary type="html"><![CDATA[Some neural network optimization algorithms mostly to implement momentum when doing back propagation.]]></summary></entry><entry><title type="html">Analysing allien plant species introduction in the Balearic Islands</title><link href="http://localhost:4000/Allien_species_introduction.html" rel="alternate" type="text/html" title="Analysing allien plant species introduction in the Balearic Islands" /><published>2021-03-12T20:32:20+01:00</published><updated>2021-03-12T20:32:20+01:00</updated><id>http://localhost:4000/Allien_species_introduction</id><content type="html" xml:base="http://localhost:4000/Allien_species_introduction.html"><![CDATA[<p>Extensive material and methods and results from this study can be read in the <a href="https://doi.org/10.1007/s10531-023-02620-z">original manuscript</a> in the Journal <a href="https://link.springer.com/journal/10531">Biodiversity and Conservation</a></p>

<p>In this post we will focus on the introduction of plant allien species in the Balearic Islands, and how we can use machine learning to analyse future trends based on historical data.</p>

<p>The main challenge in this study was to gather all publicly available data regarding introductions and think about the visualizations that would be most useful to understand the trends in the introduction of the species. From the data we gathered (one row per citation) we characterized information about the taxa (life form, taxonomic family, biogeographical origin) and about the introduction (path, date, habitat). We used this information to carry out <strong>Generalised Linear Models</strong> as follows:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Habitat_predicted_data</span><span class="o">=</span><span class="n">expand.grid</span><span class="p">(</span><span class="w">
  </span><span class="n">Fecha</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1800</span><span class="o">:</span><span class="m">2100</span><span class="p">),</span><span class="w">
  </span><span class="n">Habitat</span><span class="o">=</span><span class="n">Habitat_datamodel</span><span class="o">$</span><span class="n">Habitat</span><span class="p">)</span><span class="w">

</span><span class="n">Habitat_year_model</span><span class="o">=</span><span class="n">glm</span><span class="p">(</span><span class="n">N</span><span class="o">~</span><span class="n">Fecha</span><span class="o">+</span><span class="n">Habitat</span><span class="p">,</span><span class="w">
                     </span><span class="n">family</span><span class="o">=</span><span class="n">poisson</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s2">"log"</span><span class="p">),</span><span class="w">
                     </span><span class="n">data</span><span class="o">=</span><span class="n">Habitat_datamodel</span><span class="p">)</span><span class="w">
</span><span class="n">Habitat_year_model_int</span><span class="o">=</span><span class="n">glm</span><span class="p">(</span><span class="n">N</span><span class="o">~</span><span class="n">Fecha</span><span class="o">*</span><span class="n">Habitat</span><span class="p">,</span><span class="w">
                         </span><span class="n">family</span><span class="o">=</span><span class="n">poisson</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s2">"log"</span><span class="p">),</span><span class="w">
                         </span><span class="n">data</span><span class="o">=</span><span class="n">Habitat_datamodel</span><span class="p">)</span><span class="w">

</span><span class="n">AIC</span><span class="p">(</span><span class="n">Habitat_year_model_int</span><span class="p">,</span><span class="w">
    </span><span class="n">Habitat_year_model</span><span class="p">)</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">aov</span><span class="p">(</span><span class="n">Habitat_year_model_int</span><span class="p">))</span><span class="w">


</span><span class="n">pscl</span><span class="o">::</span><span class="n">pR2</span><span class="p">(</span><span class="n">Habitat_year_model_int</span><span class="p">)[</span><span class="m">4</span><span class="p">]</span><span class="c1">#0.81</span><span class="w">

</span><span class="n">car</span><span class="o">::</span><span class="n">Anova</span><span class="p">(</span><span class="n">Habitat_year_model_int</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"III"</span><span class="p">,</span><span class="n">singular.ok</span><span class="w"> </span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>For each variable, we used Poisson family as indicated for count data, testing model signicance with a Chi-squared test. The results showed that the model was significant, and we could use it to predict future trends in the introduction of allien species. We used car::Anova to get the significance of each variable in the model, and pscl::pR2 to get the pseudo R-squared value of the model.</p>

<p>Defined the most accurate model, we used it to make it out predictions:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predicted_intro</span><span class="o">=</span><span class="n">predict</span><span class="p">(</span><span class="n">Habitat_year_model_int</span><span class="p">,</span><span class="w">
                        </span><span class="n">newdata</span><span class="o">=</span><span class="n">Habitat_predicted_data</span><span class="p">,</span><span class="w">
                        </span><span class="n">type</span><span class="o">=</span><span class="s2">"response"</span><span class="p">,</span><span class="w">
                        </span><span class="n">se.fit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Note se.fit to TRUE to get the standard error of the predictions, which we used to calculate confidence intervals for the predictions. Plotting was carried out as follows:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Habitat_year_plot</span><span class="o">=</span><span class="n">Habitat_plot_data</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Fecha</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">Habitat</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="m">2023</span><span class="p">),</span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"#a9a9a9"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_ribbon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">fit</span><span class="o">-</span><span class="n">se.fit</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">fit</span><span class="o">+</span><span class="n">se.fit</span><span class="p">,</span><span class="w">
                  </span><span class="n">fill</span><span class="o">=</span><span class="n">Habitat</span><span class="p">,</span><span class="w">
  </span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Habitat_datamodel</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w">
            </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">N</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Number of taxa"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Habitat"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Factor sig. (Df= 6, F= 239.53, p&lt; 0.001); Interaction sig. (Df=6 , LR= 58.64, p&lt; 0.001)"</span><span class="p">),</span><span class="w">
       </span><span class="n">caption</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Model p-value&lt; 0.001; R2: 0.88"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1800</span><span class="p">,</span><span class="m">2150</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Blackburn index"</span><span class="p">,</span><span class="w">
                      </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fun_color_range</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">Habitat_datamodel</span><span class="o">$</span><span class="n">Habitat</span><span class="p">)))))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Blackburn index"</span><span class="p">,</span><span class="w">
                    </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fun_color_range</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">Habitat_datamodel</span><span class="o">$</span><span class="n">Habitat</span><span class="p">)))))</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"top"</span><span class="p">,</span><span class="w">
        </span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0.5</span><span class="p">),</span><span class="w">
        </span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">),</span><span class="w">
        </span><span class="n">text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">"Helvetica"</span><span class="p">))</span><span class="w">

</span><span class="n">Habitat_year_label_plot</span><span class="o">=</span><span class="n">directlabels</span><span class="o">::</span><span class="n">direct.label.ggplot</span><span class="p">(</span><span class="n">Habitat_year_plot</span><span class="p">,</span><span class="w">
                                                          </span><span class="nf">list</span><span class="p">(</span><span class="s2">"last.points"</span><span class="p">,</span><span class="w">
                                                               </span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w">
                                                               </span><span class="n">fontface</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Although model statistics could be automatically extracted, we decided to include them in the plot as a subtitle for clarity.  Note the inclusion of se.fit in the geom ribbon to include confidence intervals in the plot. On the other hand, we chosed to use directlabels library to label the lines in the plot, which allows for a cleaner visualization without overlapping labels. The final plot is shown below:</p>

<p><img src="./assets/img/posts/Allien_species/trends.jpg" alt="Allien species introduction in the Balearic Islands" /></p>

<p>We can observe that the introduction of allien species in the Balearic Islands has been increasing over time. The model predicts that this trend will continue in the future, with a significant increase in the number of introductions in the coming years, which could reach more than 1000 species, representing &gt;50% of the total number of plant species in the Balearic Islands.</p>

<tweet>If current trends in allien species introductions continue, by 2100 exotic species could represent &gt;50% of the total number of plant species in the Balearic Islands.</tweet>

<p>On the other hand, we can see that habitats related to human disturbance are more prone to introuctions, as well as some origins like Capense and neotropical among Cactaceae and Asteraceae family. The main introduction path is ornamental, no unintencional, so conservation efforts should focus on controlling them regualting their importation.</p>

<tweet>In the Balearic Islands main introduction pathways of plant allien speies are ornamental, no unintentional, highlighting the need for stricter regulations on plant imports.</tweet>

<p>We also aimed to analyse if allien species introductions were similar among islands. To do so, wu used unspervised machine learnign with hierarchical clustering to group islands based on the presence of allien species. We transformed islands to columns and taxa to rows, indicating 1/0 for presence/absence of the species in each island, and then calulated the distance matrix using Euclidean distance. The clustering was done using Ward’s method, which is a hierarchical clustering method that minimizes the variance within clusters.</p>

<p style="text-align:center">
\(\Delta(A, B) = \dfrac{|A| \cdot |B|}{|A| + |B|} \cdot \left\| \bar{x}_A - \bar{x}_B \right\|^2\)
</p>

<p>
where A and B are the clusters, \(|A|\) and \(|B|\) are the number of elements in each cluster, and \(\bar{x}_A\) and \(\bar{x}_B\) are the centroids of each cluster. The distance between clusters is calculated as the product of the number of elements in each cluster divided by the sum of the number of elements in both clusters, multiplied by the squared distance between the centroids of each cluster. 
</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A_PCA</span><span class="o">=</span><span class="n">A_islas</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">]</span><span class="w">

</span><span class="n">A_PCA</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">A_PCA</span><span class="p">)]</span><span class="o">=</span><span class="m">0</span><span class="w">

</span><span class="n">Data_matrix</span><span class="o">=</span><span class="n">t</span><span class="p">(</span><span class="n">A_PCA</span><span class="p">)</span><span class="w">

</span><span class="n">colnames</span><span class="p">(</span><span class="n">Data_matrix</span><span class="p">)</span><span class="o">=</span><span class="n">A_islas</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">$</span><span class="n">Taxa</span><span class="w">

</span><span class="n">d</span><span class="o">=</span><span class="n">dist</span><span class="p">(</span><span class="n">Data_matrix</span><span class="p">,</span><span class="w">
       </span><span class="n">method</span><span class="o">=</span><span class="s2">"euclidean"</span><span class="p">)</span><span class="w">

</span><span class="n">clustering</span><span class="o">=</span><span class="n">hclust</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"ward.D"</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p>We then plotted the dendrogram to visualize the clustering of islands based on the presence of allien species:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddata_x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dendro_data</span><span class="p">(</span><span class="n">as.dendrogram</span><span class="p">(</span><span class="n">clustering</span><span class="p">))</span><span class="w">
</span><span class="n">labs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">label</span><span class="p">(</span><span class="n">ddata_x</span><span class="p">)</span><span class="w">
</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">segment</span><span class="p">(</span><span class="n">ddata_x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="o">=</span><span class="n">xend</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="o">=</span><span class="n">yend</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">label</span><span class="p">(</span><span class="n">ddata_x</span><span class="p">),</span><span class="w">
            </span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">0</span><span class="p">),</span><span class="n">colour</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Euclidean distance"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_blank</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">"Helvetica"</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">



</span><span class="n">p2</span><span class="w">
</span></code></pre></div></div>

<p>The resulting plot shows that Ibiza and formentera are the most similar islands, sharing a common set of allien species. Mallorca and Menorca are also similar, btu different from minor islands, suggestign that island size plays a major role in the introduction, probably to major demographic pressure and human disturbance.</p>

<p><img src="./assets/img/posts/Allien_species/dendro.jpg" alt="Allien species introduction in the Balearic Islands by island" /></p>

<p>And that’s all for this post! We hope you found it interesting and informative. If you have any questions or comments, feel free to reach out to us.</p>]]></content><author><name>Iván Cortés, Marcello Cerrato</name></author><category term="R" /><category term="allien species" /><category term="Time series" /><category term="GLMs" /><category term="unsupervised learning" /><category term="hierarchical clustering" /><summary type="html"><![CDATA[Some neural network optimization algorithms mostly to implement momentum when doing back propagation.]]></summary></entry></feed>